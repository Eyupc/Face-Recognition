<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <img src="" id="image">
    <span id="text">Ewa</span>
    <script>
        var ws = new WebSocket("ws://localhost:4041")
        ws.binaryType = "arraybuffer"

        let encoder = new TextEncoder()
        let decoder = new TextDecoder()
        var id = Math.random().toString(36).substring(2)
        ws.onopen = ()=>{
            var dt = `{"header":"ConnectionEvent","data":[{"id":"${id}"}]}`
            ws.send(encoder.encode(dt))
            pingpong(ws)
        }

        let interval;
        function pingpong(websocket){
            
           interval =  setInterval(()=>{let data = {
                    "header":"PingEvent",
                    "data":[{
                        "message":"Pong"
                    }]
                }
                websocket.send(encoder.encode(JSON.stringify(data)))
        },1000)
        }
        
        ws.onmessage = async (msg) =>{
            if(decoder.decode(msg.data) != undefined || decoder.decode(msg.data) != null){
            try {
            let header = JSON.parse(decoder.decode(msg.data)).header
            }
            catch(error){
            
            document.getElementById("image").src =  'data:image/jpg;base64,' +  decoder.decode(msg.data)        
            }
            }

        }
        ws.onclose = () =>{
            console.log("closed")
            clearInterval(interval)
            //ws = new WebSocket("ws://localhost:4041")
        }
        ws.onerror = (e) =>{
            console.log(e)
        }



    </script>
</body>
</html>
